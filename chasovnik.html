<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ä–µ–º–µ –∏ –ö–ª–∏–º–∞—Ç</title>
    <style>
        body {
            /* –¢—ä–º–Ω–æ—Å–∏–Ω —Ñ–æ–Ω —Å –ª–µ–∫ –≥—Ä–∞–¥–∏–µ–Ω—Ç */
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: white;
            font-family: 'Segoe UI', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }

        .container {
            padding: 20px;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* –ú–µ–Ω—é –∑–∞ –∏–∑–±–æ—Ä –Ω–∞ –≥—Ä–∞–¥ */
        select {
            font-size: 22px;
            padding: 10px 30px;
            border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0, 0, 0, 0.4);
            color: white;
            cursor: pointer;
            margin-bottom: 30px;
            outline: none;
            text-align: center;
            -webkit-appearance: none;
            -moz-appearance: none;
            font-weight: bold;
        }

        select:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        select option {
            background-color: #203a43;
            color: white;
        }

        .clock {
            font-size: 120px;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 5px;
            font-variant-numeric: tabular-nums;
        }

        .sync-info {
            font-size: 14px;
            margin-bottom: 25px;
            font-weight: 400;
            letter-spacing: 1px;
            padding: 5px 15px;
            border-radius: 10px;
            display: inline-block;
            background: rgba(0,0,0,0.2);
        }

        .date {
            font-size: 26px;
            margin-bottom: 40px;
            color: #d7d7d7;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .temp-box {
            font-size: 75px;
            font-weight: bold;
            margin-bottom: 30px;
        }

        .details {
            font-size: 24px;
            display: flex;
            justify-content: center;
            gap: 60px;
            color: #e5e9f0;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .detail-label {
            font-size: 14px;
            opacity: 0.6;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <div class="container">
        <select id="city-select" onchange="getWeather()">
            <option value="sofia">üìç –°–æ—Ñ–∏—è</option>
            <option value="plovdiv">üìç –ü–ª–æ–≤–¥–∏–≤</option>
            <option value="varna">üìç –í–∞—Ä–Ω–∞</option>
            <option value="burgas">üìç –ë—É—Ä–≥–∞—Å</option>
            <option value="ruse">üìç –†—É—Å–µ</option>
            <option value="stara_zagora">üìç –°—Ç–∞—Ä–∞ –ó–∞–≥–æ—Ä–∞</option>
            <option value="pleven">üìç –ü–ª–µ–≤–µ–Ω</option>
            <option value="blagoevgrad">üìç –ë–ª–∞–≥–æ–µ–≤–≥—Ä–∞–¥</option>
        </select>

        <div class="clock" id="clock">00:00:00</div>

        <div class="sync-info" id="sync-status">‚è≥ –ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>

        <div class="date" id="date">...</div>

        <div class="temp-box" id="main-temp">--¬∞C</div>

        <div class="details">
            <div class="detail-item">
                <span id="humidity">--%</span>
                <span class="detail-label">–í–ª–∞–∂–Ω–æ—Å—Ç</span>
            </div>
            <div class="detail-item">
                <span id="wind">-- –∫–º/—á</span>
                <span class="detail-label">–í—è—Ç—ä—Ä</span>
            </div>
        </div>
    </div>

    <script>
        // --- –ì–õ–û–ë–ê–õ–ù–ò –ü–†–û–ú–ï–ù–õ–ò–í–ò ---
        let timeOffset = 0;

        // --- 1. –ö–û–û–†–î–ò–ù–ê–¢–ò ---
        const cities = {
            sofia: { lat: 42.6977, lon: 23.3219 },
            plovdiv: { lat: 42.1354, lon: 24.7453 },
            varna: { lat: 43.2141, lon: 27.9147 },
            burgas: { lat: 42.5048, lon: 27.4626 },
            ruse: { lat: 43.8356, lon: 25.9657 },
            stara_zagora: { lat: 42.4328, lon: 25.6419 },
            pleven: { lat: 43.4170, lon: 24.6067 },
            blagoevgrad: { lat: 42.0118, lon: 23.0899 }
        };

        // --- 2. –£–ú–ù–ê –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø ---
        async function smartSync() {
            const statusEl = document.getElementById('sync-status');

            try {
                // –û–ø–∏—Ç–≤–∞–º–µ –ø—ä—Ä–≤–æ WorldTimeAPI (Europe/Sofia)
                const response = await fetch('https://worldtimeapi.org/api/timezone/Europe/Sofia', {
                    cache: "no-store", // –ù–µ –ø–∞–∑–∏ –∫–µ—à
                    mode: 'cors'      // –û–ø–∏—Ç –∑–∞ –∑–∞–æ–±–∏–∫–∞–ª—è–Ω–µ –Ω–∞ CORS
                });

                if (!response.ok) throw new Error("Server Error");

                const data = await response.json();
                const serverTime = new Date(data.datetime).getTime();
                const localTime = new Date().getTime();

                timeOffset = serverTime - localTime;

                statusEl.innerText = "üì° –ê—Ç–æ–º–Ω–æ –≤—Ä–µ–º–µ (Online)";
                statusEl.style.color = "#8f8"; // –ó–µ–ª–µ–Ω–æ

            } catch (error) {
                // –ê–ö–û –°–™–†–í–™–†–™–¢ –ù–ï –°–†–ê–ë–û–¢–ò (–∑–∞—Ä–∞–¥–∏ –±—Ä–∞—É–∑—ä—Ä–Ω–∞ –∑–∞—â–∏—Ç–∞):
                console.warn("–í—Ä—ä–∑–∫–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–∞–Ω–∞, –º–∏–Ω–∞–≤–∞–º–µ –Ω–∞ –ª–æ–∫–∞–ª–µ–Ω —Ä–µ–∂–∏–º.");
                timeOffset = 0; // –ù—É–ª–∏—Ä–∞–º–µ —Ä–∞–∑–ª–∏–∫–∞—Ç–∞

                // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ —Ñ–∞–π–ª—ä—Ç –µ –æ—Ç–≤–æ—Ä–µ–Ω –ª–æ–∫–∞–ª–Ω–æ
                if (window.location.protocol === 'file:') {
                    statusEl.innerText = "üíª –õ–æ–∫–∞–ª–Ω–æ –≤—Ä–µ–º–µ (–ó–∞—â–∏—Ç–∞—Ç–∞ –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞ —Å–ø–∏—Ä–∞ —Å—ä—Ä–≤—ä—Ä–∞)";
                } else {
                    statusEl.innerText = "üíª –õ–æ–∫–∞–ª–Ω–æ –≤—Ä–µ–º–µ (–ù—è–º–∞ –≤—Ä—ä–∑–∫–∞)";
                }
                statusEl.style.color = "#ffcc00"; // –ñ—ä–ª—Ç–æ
            }
        }

        // --- 3. –ß–ê–°–û–í–ù–ò–ö ---
        function updateClock() {
            // –ò–∑–ø–æ–ª–∑–≤–∞–º–µ –æ—Ñ—Å–µ—Ç–∞ (–∞–∫–æ –∏–º–∞ —Ç–∞–∫—ä–≤)
            const now = new Date(new Date().getTime() + timeOffset);

            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            document.getElementById('clock').innerText = `${hours}:${minutes}:${seconds}`;

            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('date').innerText = now.toLocaleDateString('bg-BG', options);
        }

        // --- 4. –í–†–ï–ú–ï–¢–û (–ö–õ–ò–ú–ê–¢) ---
        async function getWeather() {
            try {
                const selectedCity = document.getElementById('city-select').value;
                const coords = cities[selectedCity];

                const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m`;

                const response = await fetch(url);
                const data = await response.json();
                const current = data.current;

                document.getElementById('main-temp').innerText = `${Math.round(current.temperature_2m)}¬∞C`;
                document.getElementById('humidity').innerText = `${current.relative_humidity_2m}%`;
                document.getElementById('wind').innerText = `${Math.round(current.wind_speed_10m)} –∫–º/—á`;

            } catch (error) {
                document.getElementById('main-temp').innerText = "--";
            }
        }

        // --- –°–¢–ê–†–¢–ò–†–ê–ù–ï ---
        smartSync(); // –û–ø–∏—Ç –∑–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
        setInterval(smartSync, 600000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Å–µ–∫–∏ 10 –º–∏–Ω

        setInterval(updateClock, 1000);
        updateClock();

        getWeather();
        setInterval(getWeather, 600000);
    </script>

</body>
</html>
